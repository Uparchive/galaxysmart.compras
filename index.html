<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Seções e Produtos</title>
    <!-- Link para o arquivo CSS externo -->
    <link rel="stylesheet" href="style.css">
    <!-- Link para a fonte Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <h2>Gerenciador de Seções e Produtos</h2>

    <!-- Formulário para adicionar novas seções -->
    <div class="add-section">
        <input type="text" id="newSectionName" placeholder="Nome da Seção">
        <button onclick="addSection()">Adicionar Seção</button>
    </div>

    <!-- Botões principais -->
    <div class="button-group-main">
        <button onclick="generateReport()">Gerar Relatório</button>
        <button onclick="saveOnline()">Salvar Online</button>
        <button onclick="organizeBySimilarity()">Organizar por Similaridade</button> <!-- Botão Adicionado -->
        <button class="toggle-saves-btn" onclick="toggleOnlineSaves()">
            Histórico Online
            <span class="arrow">&#9660;</span>
        </button>
    </div>

    <!-- Área de Contagem Total de Itens -->
    <div class="total-items">
        Total de Itens: <span id="totalItemCount">0</span>
    </div>

    <!-- Container para as seções -->
    <div id="sections"></div>

    <!-- Relatório -->
    <div id="report"></div>

    <!-- Lista de salvamentos online -->
    <div id="onlineSavesSection" style="display: none;">
        <h2>Histórico Online</h2>
        <div class="saved-cards" id="savedCards"></div>
    </div>

    <!-- Scripts do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>

    <!-- Script do SortableJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <!-- Arquivo JavaScript externo -->
    <script src="script.js"></script>

    <script>
        // Função para adicionar um item com o campo de fornecedor opcional
        function addItem(event, sectionName) {
            // Localiza a seção alvo
            const sectionDiv = event.target.closest('.section');
            if (!sectionDiv) return;

            // Captura os valores dos inputs
            const itemNameInput = sectionDiv.querySelector('.newItemName');
            const itemStoreInput = sectionDiv.querySelector('.newItemStore');
            const itemStockInput = sectionDiv.querySelector('.newItemStock');
            const itemRequestedInput = sectionDiv.querySelector('.newItemRequested');
            const itemSupplierInput = sectionDiv.querySelector('.newItemSupplier');

            // Verifica se todos os campos necessários estão preenchidos
            if (!itemNameInput || !itemStoreInput || !itemStockInput || !itemRequestedInput) {
                console.error("Algum dos campos do formulário não foi encontrado.");
                return;
            }

            // Captura os valores dos inputs
            const itemName = itemNameInput.value.trim();
            const itemStore = itemStoreInput.value.trim();
            const itemStock = parseInt(itemStockInput.value) || 0;
            const itemRequested = parseInt(itemRequestedInput.value) || 0;
            const itemSupplier = itemSupplierInput ? itemSupplierInput.value.trim() : "";

            // Cria um identificador único para o item
            const uniqueId = `${itemName}-${itemStore}-${Date.now()}`;

            // Verifica se o nome do produto e a loja foram preenchidos
            if (itemName && itemStore) {
                const section = sections.find(s => s.name === sectionName);
                if (!section) return;

                // Cria um novo item
                const newItem = {
                    name: itemName,
                    store: itemStore,
                    stock: itemStock,
                    requested: itemRequested,
                    supplier: itemSupplier,
                    purchased: 0,
                    uniqueId: uniqueId
                };

                // Adiciona o novo item à seção correspondente
                section.items.push(newItem);

                // Atualiza o DOM
                let ulElement = sectionDiv.querySelector('ul');
                if (!ulElement) {
                    ulElement = document.createElement('ul');
                    sectionDiv.appendChild(ulElement);
                }
                ulElement.classList.remove('placeholder');
                addItemToDOM(ulElement, newItem, sectionName);

                // Limpa os valores dos inputs após adicionar o item
                itemNameInput.value = '';
                itemStoreInput.value = '';
                itemStockInput.value = '';
                itemRequestedInput.value = '';
                if (itemSupplierInput) itemSupplierInput.value = '';

                // Salva o estado atualizado
                saveState();
            } else {
                alert('Por favor, insira um nome para o produto e uma loja.');
            }
        }
    </script>

</body>
</html>